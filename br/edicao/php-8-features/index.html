<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <link rel="stylesheet" href="/assets/build/css/main.css?id=5bf77e20e6f5bada38aa">
      <link rel="canonical" href="https://thephp.website/br/edicao/php-8-features/" />
      <link
    rel="alternate"
    type="application/json"
    title="[BR] thePHP Website"
    href="https://thephp.website/br/feed.json"
  />
  <link
    rel="alternate"
    type="application/rss+xml"
    title="[BR] thePHP Website"
    href="https://thephp.website/br/feed.xml"
  />
  
  <title>PHP 8.0 lan√ßado: t√° com uma cara √≥tima! | thePHP Website</title>

  <meta name="description" content="PHP 8.0 trouxe v√°rias inova√ß√µes, dentre elas incr√≠veis mudan√ßas sint√°ticas, atualiza√ß√µes nas APIs e mudan√ßas fundamentais no core e, claro, v√°rias corre√ß√µes de bug. Aqui eu vou te mostrar as principais mudan√ßas √† linguagem!">

  <meta property="og:title" content="PHP 8.0 lan√ßado: t√° com uma cara √≥tima!">
  <meta property="og:description" content="PHP 8.0 trouxe v√°rias inova√ß√µes, dentre elas incr√≠veis mudan√ßas sint√°ticas, atualiza√ß√µes nas APIs e mudan√ßas fundamentais no core e, claro, v√°rias corre√ß√µes de bug. Aqui eu vou te mostrar as principais mudan√ßas √† linguagem!">
  <meta property="og:url" content="https://thephp.website/br/edicao/php-8-features">
  <meta property="og:image" content="https://thephp.website/assets/images/posts/19-php-features-640.webp">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@nawarian">
  <meta name="twitter:title" content="PHP 8.0 lan√ßado: t√° com uma cara √≥tima!">
  <meta name="twitter:description" content="PHP 8.0 trouxe v√°rias inova√ß√µes, dentre elas incr√≠veis mudan√ßas sint√°ticas, atualiza√ß√µes nas APIs e mudan√ßas fundamentais no core e, claro, v√°rias corre√ß√µes de bug. Aqui eu vou te mostrar as principais mudan√ßas √† linguagem!">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151169766-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-151169766-3');
  </script>
  <script data-ad-client="ca-pub-3681134868307419" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Hotjar Tracking Code for thephp.website -->
  <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1770868,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
  <script>
    function toggleMenu() {
      document.querySelector('.menu__container').classList.toggle('menu__container--active');
    }
  </script>
</head>
<body class="yue non-article">
  <header class="menu">
    <a class="menu__logo" href="/br/">
      <img src="/assets/images/elephpant-idle.png" alt="" />
    </a>
    <div class="menu__title">
      <a href="/br/">thePHP Website</a>
    </div>
    <section class="menu__cta">
      <button role="button" aria-label="Open Menu" class="menu__cta__icon" onclick="typeof toggleMenu == 'function' &amp;&amp; toggleMenu()">
        <img alt="Open Menu" src="https://podentender.com.br/assets/images/icons/menu.svg">
      </button>
    </section>

    <div class="menu__container">
      <em class="menu__section-heading">
        Pages.php
      </em>
      <ul class="menu-list">
        <li class="menu__list-item">
          <a href="/br/">Home</a>
        </li>
        <li class="menu__list-item">
          <a href="/br/busca">
            busca.php
          </a>
        </li>
        <li class="menu__list-item">
          <a
            href="https://github.com/nawarian/The-PHP-Website/issues/new?title=[Suggested+Topic]%20&body=Please+describe+your+suggestion+/+Por+favor+descreva+sua+sugest√£o"
            rel="nofollow"
          >
            Pe√ßa um Post!
          </a>
        </li>
        <li class="menu__list-item">
          <a href="/br/sobre/">
            sobre.php
          </a>
        </li>
      </ul>

      <hr>
      <em class="menu__section-heading">
        Languages.php
      </em>
      <ul class="menu-list">
        <li class="menu__list-item">
          <a href="/en/">English</a>
        </li>
        <li class="menu__list-item">
          <a href="/br/">Portugu√™s</a>
        </li>
      </ul>

      <hr>
      <em class="menu__section-heading">
        Notifications.php
      </em>
      <ul class="menu-list">
        <li class="menu__list-item">
          <a href="https://thephp.website/br/feed.json">
            [BR] JSON Feed
          </a>
        </li>
        <li class="menu__list-item">
          <a href="https://thephp.website/br/feed.xml">
            [BR] Atom Feed (RSS)
          </a>
        </li>
                <li class="menu__list-item">
          <a href="https://thephp.website/br/feed-vagas.xml">
            Feed de Vagas (RSS)
          </a>
        </li>
              </ul>
    </div>
  </header>
  <article class="container">
      <div class="article">
    <time datetime="2020-11-26">
      2020-11-26
    </time>

    <h1>PHP 8.0 lan√ßado: t√° com uma cara √≥tima!</h1>
    <p><a href="/en/issue/php-8-features/">Read in English</a></p>

<p>Chegou a hora! No dia 26 de Novembro de 2020, o PHP 8.0
foi lan√ßado e tornado dispon√≠vel para download. Depois de
5 Release Candidates e um enorme esfor√ßo da comunidade,
n√≥s podemos finalmente come√ßar com o PHP 8.0 em produ√ß√£o.</p>

<p>PHP 8.0 trouxe v√°rias inova√ß√µes, dentre elas incr√≠veis
mudan√ßas sint√°ticas, atualiza√ß√µes nas APIs e mudan√ßas
fundamentais no core e, claro, v√°rias corre√ß√µes de bug.
Aqui eu vou te mostrar as principais mudan√ßas √† linguagem!</p>

<p>Mas √≥, se tu tiver sem tempo pra ver esse post inteiro, d√°
uma olhada
<a href="https://www.php.net/releases/8.0/pt_BR.php?lang=pt_BR">na p√°gina oficial de lan√ßamento do PHP 8</a>
que l√° tem um resum√£o bem visual das mudan√ßas da linguagem.</p>

<h2>Mudan√ßas Sint√°ticas do PHP 8.0</h2>

<p>H√° v√°rias mudan√ßas sint√°ticas na linguagem nesta vers√£o! Eu
consigo ver claramente uma tend√™ncia: o php est√° tentando
ficar cada vez mais ergon√¥mico quando se trata de opera√ß√µes
r√°pidas e classes.</p>

<p>Abaixo eu listo 8 mudan√ßas sint√°ticas que entraram no PHP 8.0
e dou uma introdu√ß√£o r√°pida. Todas elas ter√£o links para a
RFC que as introduziu √† linguagem, ent√£o caso voc√™ tenha
d√∫vidas basta ler os links
<a href="https://github.com/nawarian/The-PHP-Website/issues">(ou abrir uma issue, eu vou responder o quanto antes)</a>.</p>

<h3>Union Types e o Mixed Type</h3>

<p>Eu escrevi um post detalhado sobre como o sistema de tipos
do PHP se organiza entre escalares, compostos e especiais.
<a href="/br/edicao/tipos-em-php/">Voc√™ pode acessar o post neste link aqui</a>.</p>

<p>PHP 8.0 traz duas mudan√ßas importantes que transformaram os
tipos compostos em uma estrutura formal da linguagem em vez
de apenas uma conven√ß√£o como antes.</p>

<p><a href="https://wiki.php.net/rfc/union_types_v2">A primeira mudan√ßa √© a dos Union Types</a>
, que torna poss√≠vel definir que tipos uma vari√°vel pode ter
e gerar√° um erro se um tipo de valor inesperado for passado.
A sintaxe √© bem semelhante com o que o TypeScript faz:</p>

<pre><code class="language-php">&lt;?php

function sumTwo(int|float $x): int
{
  return round($x + 2);
}
</code></pre>

<p>Mas tem algumas limita√ß√µes. O tipo <code>void</code> n√£o pode ser utilizado,
e todas as declara√ß√µes de tipo n√£o podem ser amb√≠guas. Por
exemplo <code>MyClass|object</code> n√£o deveria compilar, porque <code>object</code>
j√° bate com qualquer inst√¢ncia de qualquer classe.</p>

<p><a href="https://wiki.php.net/rfc/mixed_type_v2">A segunda mudan√ßa adiciona o tipo <em>mixed</em> no PHP 8.0</a>.
O tipo <em>mixed</em> √© na verdade um Union Type muito espec√≠fico.
Voc√™ pode pensar nele como um alias do Union <code>array|bool|callable|int|float|null|object|resource|string</code>
e dever√° funcionar semelhante ao tipo <code>any</code> do TypeScript.</p>

<h3>Atributos (Annotations)</h3>

<p>Esta mudan√ßa foi definitivamente a que trouxe mais discuss√£o
na comunidade PHP. Ao todo foram 5 RFCs para compor esta
altera√ß√£o de sintaxe, todas muito discutidas pelos internals
e pela comunidade nas redes sociais.</p>

<p>A primeira vez que apareceu foi em 2016,
<a href="https://wiki.php.net/rfc/attributes">com a proposta do Dmitry</a>
, mas n√£o passou j√° que a implementa√ß√£o n√£o era suficiente para
substituir as implementa√ß√µes j√° existentes como do
<a href="https://github.com/doctrine/annotations">Doctrine\Annotations</a>
ou
<a href="https://github.com/php-annotations/php-annotations">Php-Annotations\Php-Annotations</a>.
Esta RFC foi extremamente importante para construir o conhecimento
para a RFC da nova sintaxe.</p>

<p><a href="https://wiki.php.net/rfc/attributes_v2">Em mar√ßo esta RFC foi revivida por Benjamin Eberlei e Martin Schr√∂der</a>
, corrigindo a maioria dos problemas que a comunidade encontrou
antes. A sintaxe ficou mais ou menos assim:</p>

<pre><code class="language-php">&lt;?php

use PhpAttribute;

&lt;&lt;PhpAttribute&gt;&gt;
class MyAttributesClass
{
}

&lt;&lt;MyAttributesClass&gt;&gt;
function myFunction () {}

$reflection = new ReflectionFunction('myFunction');
// ReflectionAttribute[]
var_dump($reflection-&gt;getAttributes());
</code></pre>

<p>Os Atributos s√£o refer√™ncias a classes que podem ser
instanciadas a partir do pr√≥prio objeto <em>ReflectionAttribute</em>.
Cada classe de Atributo dever√° utilizar um atributo do pr√≥prio
PHP chamado <em>PhpAttribute</em>, isto s√≥ mudou depois que a RFC
<a href="https://wiki.php.net/rfc/attribute_amendments">attribute amendments</a>
passou e agora em vez de <em>PhpAttribute</em> dever√° ser
utilizada a classe <em>Attribute</em>.</p>

<p>Esta sintaxe pode ser utilizada com:
- fun√ß√µes, closures e short closures
- classes, classes an√¥nimas, interfaces, traits
- constantes de classes
- propriedades de classes
- m√©todos de classes
- par√¢metros de fun√ß√µes ou m√©todos</p>

<p>Esta segunda RFC (attribute amendments) tamb√©m trouxe
mudan√ßas interessantes como a valida√ß√£o de que um Atributo
deveria ser utilizado somente com classes ou com fun√ß√µes,
se poderia ser utilizado v√°rias vezes ou n√£o, e tamb√©m a op√ß√£o
de agrupar utiliza√ß√µes de atributos.</p>

<p>As duas √∫ltimas RFCs (
<a href="https://wiki.php.net/rfc/shorter_attribute_syntax">esta</a>
e <a href="https://wiki.php.net/rfc/shorter_attribute_syntax_change">esta</a>
)
foram somente sobre como a sintaxe de utiliza√ß√£o dos
Attributes deveria ser. A sintaxe final adotada ficou
como a seguinte e parece bastante com a do Rust:</p>

<pre><code class="language-php">&lt;?php

use Attribute;

#[Attribute(Attribute::TARGET_FUNCTION)]
class MyAttributesClass
{
}

#[MyAttributesClass]
function myFunction () {}

$reflection = new ReflectionFunction('myFunction');
// ReflectionAttribute[]
var_dump($reflection-&gt;getAttributes());
</code></pre>

<p>Reparou naquele <code>Attribute::TARGET_FUNCTION</code> al√≠? Ele diz ao
php que aquele Attribute s√≥ pode ser utilizado com fun√ß√µes
e um erro ser√° gerado se utilizado em qualquer outro lugar.</p>

<h3>Operador Nullsafe</h3>

<p><em>Uncaught Error: Call to a member function example() on null</em>.
Este erro aqui persegue muitos(as) engenheiros(as) php que podem
ter esquecido de verificar o tipo de retorno ou tenham escrito
errado uma condi√ß√£o if.</p>

<p>Isto vai mudar no PHP 8.0, com a
<a href="https://wiki.php.net/rfc/nullsafe_operator">introdu√ß√£o do operador nullsafe</a>.
Esta sintaxe faz verifica√ß√µes em valores nulos e d√° um curto-circuito
se alguma parte da cadeia for null, evitando uncaught errors como
o mencionado acima. A sintaxe √© a seguinte:</p>

<pre><code class="language-php">&lt;?php

$obj = new class {
  public function f()
  {
    return null;
  }
}

// "$obj?-&gt;" verifica se $obj √© null e,
// caso n√£o, continua coma a chamada
// "f()?-&gt;" verifica se o tipo do retorno de f()
// √© null como acima
$obj?-&gt;f()?-&gt;neverCalled();

// neverCalled() nunca foi chamado, pois f() retorna null
</code></pre>

<h3>Non-Capturing Catches</h3>

<p>Sempre que escrevemos o bloco <em>catch</em> quando tratamos
uma exce√ß√£o √© necess√°rio receber tamb√©m o objeto Exception.</p>

<p><a href="https://wiki.php.net/rfc/non-capturing_catches">No PHP 8.0, gra√ßas ao Max Semenik</a>
, n√£o ser√° mais necess√°rio fazer isso. Agora √© poss√≠vel
capturar exce√ß√µes sem precisar capturar o objeto em si.
Como no exemplo abaixo:</p>

<pre><code class="language-php">&lt;?php

try {
  throw new IncredibleException();
} catch (IncredibleException) {
  // Eu n√£o ligo tanto pro
  // objeto $exceptionabout
  // the $exception object
} catch (Exception $e) {
  // Mas aqui eu ligo, e tudo bem
}
</code></pre>

<h3>Throw Expression</h3>

<p>Anteriormente a palavra chave <em>throw</em> era considerado um
<em>statement</em> na linguagem, o que nos impediu por muito tempo
de lan√ßar exce√ß√µes em alguns lugares onde apenas express√µes
como atribui√ß√£o de vari√°veis, short closures, tern√°rios
e express√µes bin√°rias poderiam estar.</p>

<p><a href="https://wiki.php.net/rfc/throw_expression">Ilija Tovilo implementou a RFC Throw Exception</a>
que transformou <code>throw $obj</code> numa express√£o. Ent√£o os exemplos
abaixo s√£o v√°lidos:</p>

<pre><code class="language-php">&lt;?php

$a = null ?? throw new Exception();
$b = $obj-&gt;func() || throw new Exception();
$c = fn() =&gt; throw new Exception();
</code></pre>

<p>Esta funcionalidade foi inspirada numa mudan√ßa introduzida
ao C# em 2017 e uma proposta ao ECMAScript escrita em 2018.</p>

<h3>Express√£o Match</h3>

<p>Esta √© a minha favorita! A inten√ß√£o √© trazer uma sintaxe
mais limpa sempre que normalmente far√≠amos um <em>switch</em> para
decidir o valor de uma vari√°vel.</p>

<p><a href="https://wiki.php.net/rfc/match_expression_v2">A RFC foi escrita por Ilija Tovilo</a>
e nesta vers√£o ainda n√£o oferece suporte a blocos, ent√£o
apenas express√µes s√£o permitidas. A utiliza√ß√£o ficou assim:</p>

<pre><code class="language-php">&lt;?php

$a = 100;

$duzentos = match ($a) {
  10, 100, 1000 =&gt; $a * 2,
  50, 500, 5000 =&gt; $a / 2,
};
</code></pre>

<p>O snippet acima retornaria <code>$a * 2</code> sempre que $a for igual a 10,
100 ou 1000. Retornaria <code>$a / 2</code> sempre que $a for igual a 50,
500 ou 5000.</p>

<p>√â importante observer que a sintaxe de Match constr√≥i uma express√£o,
ent√£o ela pode ser armazenada em vari√°veis, passada como par√¢metro
ou ser composta com outras express√µes.</p>

<pre><code class="language-php">&lt;?php

$type = ...;
$filter = match ($type) {
  'as_object' =&gt; $myObject,
  'assoc' =&gt; $myObject-&gt;toArray(),
} || throw new InvalidArgumentException('Invalid type requested.');
</code></pre>

<p>Implementa√ß√µes futuras ir√£o adicionar suporte a blocos ao
lado direito desta express√£o, de forma semelhante ao que
o Rust faz. Isto d√° ao desenvolvedor(a) maior flexibilidade
para escrever programas complexos sem invadir escopos
de vari√°veis.</p>

<h3>Named Parameters</h3>

<p>√â bem comum ver m√©todos com par√¢metros contendo valores padr√£o
e os √∫nicos que queremos mudar s√£o os √∫ltimos. Isto nos for√ßa
a entrar com <code>null</code> em todos os par√¢metros para mudar apenas
os √∫ltimos.</p>

<p>Muitos podem dizer que isto √© um problema de design, mas ao
mesmo tempo n√£o √© poss√≠vel simplesmente garantir um √≥timo
design para cada projeto open source escrito por a√≠.</p>

<p><a href="https://wiki.php.net/rfc/named_params">Nikita Popov decidiu adicionar o Named Parameters ao PHP 8.0</a>
, que nos permite pular par√¢metros de fun√ß√µes ou m√©todos e
definir valores somente para as que nos importam. Para isso
as vari√°veis precisam ser nomeadas, funciona assim:</p>

<pre><code class="language-php">&lt;?php

function myFunc(
  $a = 10,
  $b = 20,
  $c = null
) {
}

myFunc(c: 100);
// $a = 10; $b = 20; $c = 100
</code></pre>

<p>Isto tamb√©m nos d√° a liberdade de desconsiderar a ordem dos
par√¢metros definida pela interface.</p>

<p>Eu acho que esta √© uma √≥tima forma para criar um c√≥digo mais
bem escrito sem quebrar bibliotecas e extens√µes que j√° existem.</p>

<h3>Constructor Promotion</h3>

<p>Alguns dizem que o PHP √© t√£o verboso quanto o Java quando se
trata de Orienta√ß√£o a Objetos. Eu tendo a concordar e creio que
poder√≠amos importar algumas facilidades de sintaxe que outras
linguagens j√° constru√≠ram e obtiveram sucesso.</p>

<p><a href="https://wiki.php.net/rfc/constructor_promotion">A sintaxe constructor promotion</a>
torna mais simples e r√°pido escrevre classes que recebem
par√¢metros no construtor e os joga em propriedades imediatamente.</p>

<p>O snippet abaixo ilustra bem esta nova sintaxe:</p>

<pre><code class="language-php">&lt;?php

class MyClass
{
  public function __construct(public int $x = 0)
  {}
}

// √â equivalente a isto:

class MyClass
{
  private int $x;

  public function __construct(int $x = 0)
  {
    $this-&gt;x = $x;
  }
}
</code></pre>

<h2>Mudan√ßas na M√°quina Virtual do PHP 8</h2>

<p>Mudan√ßas no core s√£o normalmente as que podem quebrar
nosso c√≥digo de forma expl√≠cita ou silenciosamente, ent√£o
√© importante tomar uma boa aten√ß√£o nelas enquanto atualizamos
a vers√£o do PHP.</p>

<p>Esta vers√£o trouxe atualiza√ß√µes muito bacanas ao PHP que impactam
performance e comportamente. Aqui eu vou listar algumas delas.</p>

<h3>Compilador Just In Time (JIT)</h3>

<p><a href="/br/edicao/php-8-jit/">Eu escrevi um artigo sobre o que √© o JIT e como ele funciona no PHP</a>.
Recomendo fortemente que voc√™ d√™ uma lida, ele vai te dar
uma ideia melhor sobre como o PHP funciona internamente e
quais benef√≠cios um compilador Just In Time pode trazer
√† linguagem.</p>

<p>Resum√£o do ENEM: o JIT pode aumentar a performance das
nossas aplica√ß√µes PHP, pode ser otimizado para melhores
resultados e constr√≥i uma funda√ß√£o para aplica√ß√µes PHP
diferentes do que estamos acostumados a ver.</p>

<p>Mas isto n√£o vai acontecer em toda aplica√ß√£o PHP. H√° casos
de uso muito espec√≠ficos para o JIT e eu acho que o
que voc√™ pode fazer de melhor √© <a href="https://wiki.php.net/rfc/jit">verificar a RFC</a>
e <a href="/br/edicao/php-8-jit/">ler o post que eu mencionei acima</a>.</p>

<p>Uma coisa interessante sobre esta funcionalidade √© que
ela foi implementada antes da RFC de attributes ser
aprovada. Ent√£o uma das op√ß√µes dispon√≠veis √© compilar
apenas fun√ß√µes/m√©todos anotados com um doc-comment <code>@jit</code>.
Isto poder√° mudar no futuro ao adicionar uma op√ß√£o nativa
<code>#[jit]</code> usando Attributes em vez de doc-comments.</p>

<h3>Weak Maps</h3>

<p>O PHP 7.4 nos trouxe uma classe weak-reference (refer√™ncia fraca),
que nos permite criar uma refer√™ncia a um objeto sem que
ele fique impedido de ser coletado pelo Garbage Colelctor.</p>

<p><a href="https://wiki.php.net/rfc/weak_maps">Agora no PHP 8.0 a classe WeakMap foi adicionada</a>.
Weak Maps usam o mesmo conceito de Weak References mas
implementam as interfaces <em>ArrayAccess</em>, <em>Countable</em> e
<em>Traversable</em>. Isto nos permite criar cole√ß√µes (maps) que n√£o
impedem que seus objetos sejam destruidos quando todas as
outras refer√™ncias forem removidas.</p>

<p>Eu pretendo escrever melhor sobre Garbage Collection no PHP
no futuro, mas se voc√™ quiser botar uma press√£o pra ver este
conte√∫do logo me d√° um al√¥ l√° no Twitter ou abre uma issue pra
que eu d√™ prioridade a este assunto.</p>

<p>Aqui vai um exemplo de como utilizar WeakMaps:</p>

<pre><code class="language-php">&lt;?php

$bag = new WeakMap();
$obj = new stdClass();

$bag[$obj] = 42;

// int(1)
var_dump($bag-&gt;count());

// deleta $obj da mem√≥ria
// $bag est√° vazia agora
unset($obj);

// int(0)
var_dump($bag-&gt;count());
</code></pre>

<h3>Erros e Alertas</h3>

<p>Esta RFC mudou a forma como o PHP se comporta e √©
importante que a gente preste bastante aten√ß√£o nela!</p>

<p>Muitas mensagens de erro e n√≠vel de criticidade mudaram
para que fiquem mais consistentes. Nenhum n√≠vel de
criticidade caiu, apenas cresceram. Alguns Notices se
tornar√£o Warnings, e alguns Warnings se tornar√£o
Errors (lan√ßar√£o exce√ß√£o).</p>

<p>A lista completa voc√™ consegue encontrar
<a href="https://wiki.php.net/rfc/engine_warnings">na p√°gina da RFC</a>
e eu recomendo fortemente que voc√™ d√™ uma lida j√° que
este tipo de problema pode aparecer de forma bem silenciosa
se voc√™ n√£o tiver um bom monitoramento configurado.</p>

<h3>Verifica√ß√µes das Assinaturas de M√©todos M√°gicos</h3>

<p>Esta mudan√ßa foi introduzida pelo querido Gabriel Caruso,
do PHPSP, que tive o prazer de conhecer neste ano! Ele
adicionou verifica√ß√µes de tipos nas assinaturas dos
m√©todos m√°gicos do PHP da forma definida na documenta√ß√£o.</p>

<p>Toda classe implementando m√©todos m√°gicos que n√£o forem
escritas de accortdo com a assinatura ir√° gerar um <code>FatalError</code>
como voc√™ pode verificar <a href="https://wiki.php.net/rfc/magic-methods-signature">na p√°gina da RFC</a>.
Mesmo sendo uma breaking change, apenas 7 dos top 1000
pacotes no Packagist seriam afetados por esta mudan√ßa.</p>

<h3>Corre√ß√µes em Strings Num√©ricas</h3>

<p>O PHP consegue converter strings num√©ricas em inteiros
quando necess√°rio. Este cast pode acontecer manualmente
ou de forma impl√≠cita dependendo de qual opera√ß√£o voc√™
executar (por exemplo, express√µes e chamadas de fun√ß√£o).</p>

<pre><code class="language-php">&lt;?php

// int(123)
var_dump((int) "123");
</code></pre>

<p>Ainda mais, o PHP √© uma m√£e quando se trata de strings
num√©ricas: perdoa tudo! Strings como <code>"2 bananas"</code> ou
<code>"5 ma√ß√£s"</code> podem ser convertidas para n√∫meros normalmente.
Mais do que isso, algumas strings podem ser interpretadas
como num√©ricas quando n√£o deveriam (como em hashes que
come√ßam com um zero, por exemplo).</p>

<p><a href="https://wiki.php.net/rfc/saner-numeric-strings">A RFC saner numeric strings</a>
veio corrigir este problema, normalizadno a forma como
n√≥s lidamos com strings num√©ricas e gerando Type Errors
quando tipos num√©ricos s√£o requeridos mas uma string
n√£o num√©rica √© passada.</p>

<h3>Mudan√ßas na Compara√ß√£o de String Num√©ricas</h3>

<p>O PHP tem dois modos de compara√ß√£o: estrito (<code>===</code>, <code>!==</code>)
e n√£o estrito (todo o resto). Sempre que fazemos uma
compara√ß√£o n√£o estrita entre uma string e um n√∫mero, o PHP
vai tentar converter a string em um n√∫mero para s√≥ ent√£o
comparar dois inteiros.
<a href="/br/edicao/tipos-em-php/">Eu explico este processo em detalhe neste post aqui</a>.</p>

<p>Este comportamento criou distor√ß√µes bem estranhas como
a express√£o <code>0 == 'nawarian'</code> retornando <code>bool(TRUE)</code>.</p>

<p><a href="https://wiki.php.net/rfc/string_to_number_comparison">A RFC de compara√ß√µes de strings num√©ricas</a>
melhora estas compara√ß√µes ao inverter a l√≥gica de convers√£o:
em vez de converter a string em n√∫mero e ent√£o comparar os dois
n√∫meros, o PHP ir√° transformar o n√∫mero em string e ent√£o
comparar as duas strings.</p>

<p>Uma nova tabela de compara√ß√£o foi disponibilizada na RFC
e eu trouxe uma c√≥pia pra c√°:</p>

<table>
<thead>
<tr>
  <th>Compara√ß√£o</th>
  <th>Antes</th>
  <th>Depois</th>
</tr>
</thead>
<tbody>
<tr>
  <td>0 == "0"</td>
  <td>true</td>
  <td>true</td>
</tr>
<tr>
  <td>0 == "0.0"</td>
  <td>true</td>
  <td>true</td>
</tr>
<tr>
  <td>0 == "foo"</td>
  <td>true</td>
  <td>false</td>
</tr>
<tr>
  <td>0 == ""</td>
  <td>true</td>
  <td>false</td>
</tr>
<tr>
  <td>42 == "   42"</td>
  <td>true</td>
  <td>true</td>
</tr>
<tr>
  <td>42 == "42foo"</td>
  <td>true</td>
  <td>false</td>
</tr>
</tbody>
</table>

<h2>Agora √© aproveitar e aguardar as pr√≥ximas</h2>

<p>√â claro que tem muito mais coisas que o PHP 8.0 trouxe
e eu gostaria muito de ter tido o tempo e vontade para
escrever todas aqui. Mas esta pequena lista j√° deixa claro
que o PHP, morrendo desde 1994, mais uma vez se torna
melhor e mais poderoso.</p>

<p>Eu atualmente n√£o conhe√ßo nenhum benchmark sobre o PHP 8.0
rodando aplica√ß√µes de verdade que possam dizer que esta
vers√£o √© mais r√°pida, a mesma coisa ou mais lenta. Mas eu
confio que as ferramentas que a comunidade nos deu ir√£o
nos permitir continuar criando aplica√ß√µes incr√≠veis e
r√°pidas.</p>

<p>A adi√ß√£o do compilador Just In Time √© uma boa oportunidade
para olhar com mais carinho para ferramentas que n√≥s
poder√≠amos explorar bem melhor como, por exemplo, a Extens√£o
Swoole.</p>

<p>Agora √© momento de celebrar esta incr√≠vel vit√≥ria da
Comunidade PHP e agradecer todas as pessoas que se envolveram
(voc√™ tamb√©m est√° nesta lista üòâ). A vers√£o 8.1 alpha j√°
iniciou o desenvolvimento e eu mal posso esperar por o
que vem pela frente!</p>

<p>Por favor, n√£o se esque√ßa de compartilhar com seus amigos
e colegas, e me d√™ um toque se voc√™ encontrou alguma coisa
estranha aqui ou gostaria de adicionar voc√™ mesmo alguma
coisa estranha.</p>

<div class="align-right">
  --
  <a href="https://twitter.com/nawarian" rel="nofollow">
    @nawarian
  </a>
</div>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "PHP 8.0 lan√ßado: t√° com uma cara √≥tima!",
  "description": "PHP 8.0 trouxe v√°rias inova√ß√µes, dentre elas incr√≠veis mudan√ßas sint√°ticas, atualiza√ß√µes nas APIs e mudan√ßas fundamentais no core e, claro, v√°rias corre√ß√µes de bug. Aqui eu vou te mostrar as principais mudan√ßas √† linguagem!",
  "image": [
    "https://thephp.website/assets/images/posts/19-php-8-features-640.webp"
   ],
  "datePublished": "2020-11-26T00:00:00+08:00",
  "dateModified": "2020-11-26T00:00:00+08:00",
  "author": {
    "@type": "Person",
    "name": "Nawarian N√≠ckolas Da Silva"
  },
   "publisher": {
    "@type": "Organization",
    "name": "ThePHP Website",
    "logo": {
      "@type": "ImageObject",
      "url": "https://thephp.website/favicon.ico"
    }
  }
}
</script>
  </div>
  </article>
  <aside class="container">
          <div class="recommended">
      <h3>Keep reading</h3>
      <ul class="card-list">
                  <li class="card">
            <a href="https://thephp.website/br/edicao/operacoes-bitwise-php/">
                              <div
                        class="card__image"
                        style="background-image: url(/assets/images/posts/20-bitwise-php/cover-640.webp)"
                        alt="Uma silhueta humana pintada com zeros e uns"
                ></div>
              
              <div class="card__content">
                <h4>Opera√ß√µes bin√°rias (bitwise) com PHP</h4>
                <p>Recentemente eu trabalhei em diferentes projetos que me for√ßaram a usar bastante opera√ß√µes com bin√°rios em PHP. De ler arquivos a emular processadores, este √© um conhecimento interessant√≠ssimo e muito √∫til.</p>
                <time>2021-02-24</time>
              </div>
            </a>
          </li>
                  <li class="card">
            <a href="https://thephp.website/br/edicao/tipos-em-php/">
                              <div
                        class="card__image"
                        style="background-image: url(/assets/images/posts/17-php-type-system-640.webp)"
                        alt="Uma mulher segurando um livro sobre textos cru√©is."
                ></div>
              
              <div class="card__content">
                <h4>Tudo o que voc√™ precisa (e n√£o precisa) saber sobre Tipos no PHP</h4>
                <p>Este √© o melhor guias entre todos que voc√™ encontrar√° na internet sobre como o PHP lida com seus tipos internamente.</p>
                <time>2020-07-29</time>
              </div>
            </a>
          </li>
                  <li class="card">
            <a href="https://thephp.website/br/edicao/messagepack-vs-json-benchmark/">
                              <div
                        class="card__image"
                        style="background-image: url(/assets/images/posts/11-messagepack-640.webp)"
                        alt="Uma fotografia de v√°rios chips de CPU."
                ></div>
              
              <div class="card__content">
                <h4>Comparando JSON e MessagePack</h4>
                <p>MessagePack ganha em praticamente todos os testes. Mas a diferen√ßa √© t√£o pequena que eu quase n√£o consigo ver benef√≠cios em migrar do JSON para msgpack. Mas resultados mais interessantes podem brotar com a chegada do JIT no PHP 8...</p>
                <time>2020-03-15</time>
              </div>
            </a>
          </li>
              </ul>
    </div>
    </aside>
</body>
<script src="/assets/build/js/main.js?id=62c9a83d4ba6e7454179"></script>
</html>
